# review.nvim Progress Log

## 2026-01-25 - Session 1

### Completed
- Reviewed and refined PLAN.md based on requirements discussion
- Updated Comment data structure with start_line, end_line, extmark_id fields
- Added pr_mode field to State ("remote" | "local")
- Added core/line_tracker.lua module spec for extmark-based position tracking
- Added utils.lua module spec with shared utilities (debounce, relative_time, truncate, etc.)
- Updated thread resolution to use GraphQL via `gh api graphql`
- Simplified OpenCode provider to CLI-only (removed opencode.nvim dependency)
- Updated Implementation Order to include new modules
- Added Progress Tracking section to PLAN.md
- Refactored float.lua and panel.lua to use shared utils.relative_time
- Created justfile with Ralph loop recipes (ralph-once, afk-ralph, ralph-sandbox)
- Restructured Implementation Order to introduce tests earlier (test-first approach)

### In Progress
- Phase 1: Test Infrastructure + Core Foundation

### Completed This Session
- [x] tests/init.lua - Test runner setup (mini.test)
- [x] tests/helpers.lua - Shared test utilities (mock_diff, mock_pr, mock_comments, expect helpers)
- [x] plugin/review.lua - Plugin loader (minimal, with Neovim 0.10+ version check)

### Completed This Session (continued)
- [x] lua/review/utils.lua - Shared utilities (debounce, relative_time, truncate, normalize_path, is_valid_buf/win, safe_require, generate_id)
- [x] tests/unit/test_utils.lua - Utils tests (24 tests passing)
- [x] lua/review/init.lua - Minimal module entry point for loading
- [x] lua/review/config.lua - Configuration system (UI, signs, keymaps, github, AI settings)
- [x] tests/unit/test_config.lua - Config tests (20 tests passing)
- [x] lua/review/core/state.lua - State management (Review.State, comments, files, PR data)
- [x] tests/unit/test_state.lua - State tests (33 tests passing)

### Completed This Session (continued 2)
- [x] lua/review/core/comments.lua - Comment CRUD (add, edit, delete, reply, set_resolved, mark_submitted, get_at_line, etc.)
- [x] tests/unit/test_comments.lua - Comments tests (46 tests passing)

### Next Steps
- Phase 2: Git + Diff Parsing
  9. Create lua/review/integrations/git.lua - Git CLI wrapper
  10. Create lua/review/core/diff_parser.lua - Parse git diff output
  11. Create tests/unit/test_diff_parser.lua - Diff parser tests
  12. Create tests/mocks/git.lua - Git mock for testing

### Issues/Blockers
- None

### Decisions Made
- Diff edits: Auto-save on :w (edit real file in diff mode)
- PR modes: Support both remote (read-only) and local (editable when checked out)
- Thread resolution: Use gh api graphql
- AI providers: CLI-only integration (no Neovim plugin dependencies)
- Comment positions: Track with Neovim extmarks
- Multi-line comments: Full LEFT/RIGHT side support
- Scope: Full plan implementation

---
