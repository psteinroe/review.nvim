# review.nvim Progress Log

## 2026-01-25 - Session 1

### Completed
- Reviewed and refined PLAN.md based on requirements discussion
- Updated Comment data structure with start_line, end_line, extmark_id fields
- Added pr_mode field to State ("remote" | "local")
- Added core/line_tracker.lua module spec for extmark-based position tracking
- Added utils.lua module spec with shared utilities (debounce, relative_time, truncate, etc.)
- Updated thread resolution to use GraphQL via `gh api graphql`
- Simplified OpenCode provider to CLI-only (removed opencode.nvim dependency)
- Updated Implementation Order to include new modules
- Added Progress Tracking section to PLAN.md
- Refactored float.lua and panel.lua to use shared utils.relative_time
- Created justfile with Ralph loop recipes (ralph-once, afk-ralph, ralph-sandbox)
- Restructured Implementation Order to introduce tests earlier (test-first approach)

### In Progress
- Phase 1: Test Infrastructure + Core Foundation

### Completed This Session
- [x] tests/init.lua - Test runner setup (mini.test)
- [x] tests/helpers.lua - Shared test utilities (mock_diff, mock_pr, mock_comments, expect helpers)
- [x] plugin/review.lua - Plugin loader (minimal, with Neovim 0.10+ version check)

### Completed This Session (continued)
- [x] lua/review/utils.lua - Shared utilities (debounce, relative_time, truncate, normalize_path, is_valid_buf/win, safe_require, generate_id)
- [x] tests/unit/test_utils.lua - Utils tests (24 tests passing)
- [x] lua/review/init.lua - Minimal module entry point for loading
- [x] lua/review/config.lua - Configuration system (UI, signs, keymaps, github, AI settings)
- [x] tests/unit/test_config.lua - Config tests (20 tests passing)
- [x] lua/review/core/state.lua - State management (Review.State, comments, files, PR data)
- [x] tests/unit/test_state.lua - State tests (33 tests passing)

### Completed This Session (continued 2)
- [x] lua/review/core/comments.lua - Comment CRUD (add, edit, delete, reply, set_resolved, mark_submitted, get_at_line, etc.)
- [x] tests/unit/test_comments.lua - Comments tests (46 tests passing)

### Completed This Session (continued 3)
- [x] lua/review/integrations/git.lua - Git CLI wrapper (run, run_async, diff, changed_files, diff_stats, parse_repo, etc.)
- [x] tests/unit/test_git.lua - Git tests (41 tests passing)

### Completed This Session (continued 4)
- [x] lua/review/core/diff_parser.lua - Parse git diff output into structured data
- [x] tests/unit/test_diff_parser.lua - Diff parser tests (30 tests passing)

### Completed This Session (continued 5)
- [x] tests/mocks/git.lua - Git mock for testing (40 tests passing)
- [x] tests/unit/test_mock_git.lua - Mock git tests
- [x] Updated tests/init.lua to include mocks directory in Lua path

### Completed This Session (continued 6)
- [x] lua/review/ui/highlights.lua - Highlight groups (signs, virtual text, file tree, panel, etc.)
- [x] tests/unit/test_highlights.lua - Highlights tests (29 tests passing)

### Completed This Session (continued 7)
- [x] lua/review/ui/layout.lua - Window management (tabpage, file tree, diff windows)
- [x] tests/unit/test_layout.lua - Layout tests (39 tests passing)

### Completed This Session (continued 8)
- [x] lua/review/ui/file_tree.lua - File tree panel (hierarchical display, navigation, selection, keymaps)
- [x] tests/unit/test_file_tree.lua - File tree tests (48 tests passing)

### Completed This Session (continued 9)
- [x] lua/review/ui/diff.lua - Diff view rendering (local/PR modes, side-by-side diff, navigation)
- [x] tests/unit/test_diff.lua - Diff tests (35 tests passing)

### Completed This Session (continued 10)
- [x] lua/review/ui/signs.lua - Gutter signs for comments (place/remove, refresh, navigation)
- [x] tests/unit/test_signs.lua - Signs tests (49 tests passing)

### Completed This Session (continued 11)
- [x] lua/review/ui/virtual_text.lua - Inline comment previews (icons, truncation, enable/disable, refresh)
- [x] tests/unit/test_virtual_text.lua - Virtual text tests (59 tests passing)
- [x] Added virtual_text config to lua/review/config.lua (enabled, max_length, position)

### Completed This Session (continued 12)
- [x] lua/review/ui/float.lua - Floating window helpers (create, show_comment, input, multiline_input, confirm, notify, menu, etc.)
- [x] tests/unit/test_float.lua - Float tests (59 tests passing)

### Completed This Session (continued 13)
- [x] lua/review/core/navigation.lua - All navigation (comments, files, hunks, focus management)
- [x] tests/unit/test_navigation.lua - Navigation tests (41 tests passing)

### Completed This Session (continued 14)
- [x] lua/review/commands.lua - User commands (:Review, :ReviewAI, :ReviewComment)
- [x] tests/unit/test_commands.lua - Commands tests (40 tests passing)

### Next Steps
- Phase 5: Navigation + Commands (continued)
  28. Create keymaps.lua - Keymap setup

### Issues/Blockers
- None

### Decisions Made
- Diff edits: Auto-save on :w (edit real file in diff mode)
- PR modes: Support both remote (read-only) and local (editable when checked out)
- Thread resolution: Use gh api graphql
- AI providers: CLI-only integration (no Neovim plugin dependencies)
- Comment positions: Track with Neovim extmarks
- Multi-line comments: Full LEFT/RIGHT side support
- Scope: Full plan implementation

---
