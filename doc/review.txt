*review.txt*  Code review plugin for Neovim with GitHub and AI integration

Author:  psteinroe
License: MIT

==============================================================================
CONTENTS                                                     *review-contents*

    1. Features ........................... |review-features|
    2. Requirements ....................... |review-requirements|
    3. Installation ....................... |review-installation|
    4. Configuration ...................... |review-configuration|
    5. Usage .............................. |review-usage|
    6. Workflow Examples .................. |review-workflow-examples|
    7. API ................................ |review-api|

A Neovim plugin for efficient code reviews with GitHub integration and AI feedback loops.
==============================================================================
FEATURES                                                     *review-features*

- Local diff review - Review AI-generated or manual code changes
- GitHub PR review - Full comment integration with GitHub PRs
- Hybrid mode - Auto-detects PR branch, shows file provenance (pushed/local/uncommitted)
- AI feedback loop - Send reviews to AI providers for iteration
- Editable diffs - Fix issues directly while reviewing
- Unified comments - Local and GitHub comments in one view
- Smart diffing - Uses merge-base to show only PR changes, not unrelated commits
- @mention autocomplete - Type `@` in comments to autocomplete GitHub usernames
- Keyboard-driven - Everything accessible via keymaps
==============================================================================
REQUIREMENTS                                             *review-requirements*

- Neovim 0.10+
- `gh` CLI (optional, for GitHub integration)
==============================================================================
INSTALLATION                                             *review-installation*

==============================================================================
CONFIGURATION                                           *review-configuration*

>lua
    require("review").setup({
      -- UI settings
      ui = {
        tree_width = 30,      -- Width of file tree panel
        panel_width = 80,     -- Width of PR panel
        panel_height = 40,    -- Height of PR panel
      },
      -- Signs shown in gutter
      signs = {
        comment_github = "G",
        comment_local = "L",
        comment_issue = "!",
        comment_suggestion = "*",
        comment_praise = "+",
        comment_resolved = "R",
      },
      -- Keymaps (set enabled = false to define your own)
      keymaps = {
        enabled = true,
      },
      -- GitHub settings
      github = {
        enabled = true,
        picker_default = "review_requests",  -- "review_requests", "open_prs", "my_prs"
        picker_show_menu = false,            -- false = go directly to default mode
      },
      -- AI provider settings
      ai = {
        provider = "auto",    -- "auto", "opencode", "claude", "codex", "custom"
        command = nil,        -- Custom command with $PROMPT_FILE placeholder
        auto_reload = true,   -- Auto-reload buffers when files change
        on_complete = nil,    -- Callback when AI finishes
      },
      -- Virtual text (inline comment preview)
      virtual_text = {
        enabled = true,
        max_length = 40,
        position = "eol",
      },
    })
<
==============================================================================
USAGE                                                           *review-usage*

COMMANDS ~

    Command         Description
    :Review         Auto-detect: hybrid mode if on PR branch, else local diff
    :Review {base}  Open local diff against branch/commit
    :Review pr      Open PR picker
    :Review pr {number} Open specific PR
    :Review next    Open next unreviewed PR from review requests
    :Review close   Close review session
    :Review panel   Toggle PR panel
    :Review refresh Refresh current review
    :Review status  Show review status
    :ReviewAI       Send to AI (opens editable prompt)
    :ReviewAI pick  Show provider picker
    :ReviewAI clipboard Copy to clipboard
    :ReviewAICancel Cancel running AI job
    :ReviewAIStatus Show AI job status
    :ReviewAIOutput Show AI job output
    :ReviewComment  Add note comment at cursor
    :ReviewComment {type} Add comment (note/issue/suggestion/praise)

KEYMAPS ~

All keymaps are active when a review session is open.

File Navigation ~

    Keymap          Action
    <C-j>           Next file in tree
    <C-k>           Previous file in tree

Comment Navigation ~

    Keymap          Action
    ]c              Next comment
    [c              Previous comment
    ]u              Next unresolved comment
    [u              Previous unresolved comment
    ]m              Next pending comment
    [m              Previous pending comment

Hunk Navigation ~

    Keymap          Action
    <Tab>           Next hunk (across files)
    <S-Tab>         Previous hunk (across files)

Views ~

    Keymap          Action
    <leader>rp      Toggle PR panel
    <leader>rf      Focus file tree
    <leader>rd      Focus diff view
    <leader>rD      Toggle diff split (hide/show base version)
    <leader>rq      Close review
    <leader>rn      Accept current file and open next

Comment Actions ~

    Keymap          Action
    <leader>cc      Add note comment
    <leader>ci      Add issue comment
    <leader>cs      Add suggestion comment
    <leader>cp      Add praise comment
    <leader>ce      Edit comment at cursor
    <leader>cd      Delete comment at cursor
    K               Show comment popup (interactive)
    r               Reply to comment
    R               Toggle resolve status

PR Actions ~

    Keymap          Action
    <leader>rC      Add conversation comment
    <leader>rs      Send to AI (opens editable prompt)
    <leader>rS      Pick AI provider
    <leader>rX      Cancel running AI job
    <leader>ry      Copy to clipboard
    <leader>rg      Submit to GitHub
    <leader>ra      Approve PR
    <leader>rx      Request changes
    <leader>rG      Submit as comment (no approval decision)

Pickers ~

    Keymap          Action
    <leader>rr      Pick from review requests
    <leader>rl      Pick from open PRs

FILE TREE LAYOUT ~

Files are grouped by directory with collapsible sections:
>
    PR #123 (12 files)
    main ‚Üê feat/auth
    3/12 reviewed
    ‚ñº src/components/               4
      ‚úì M LoginForm.tsx             3
      ¬∑ A AuthProvider.tsx
    ‚ñ∂ tests/                        1
<
Directory headers:
    Symbol          Meaning
    ‚ñº             Directory expanded (files visible)
    ‚ñ∂             Directory collapsed (files hidden)
File lines (indented under directories):
    Symbol          Meaning
    ‚úì             File reviewed (staged in local mode, viewed in PR mode)
    ¬∑              File pending review
    A               Added (new file)
    M               Modified
    D               Deleted
    R               Renamed
Comment count (right-aligned):
    Format          Meaning
    3               3 comments on this file
    3*              3 comments, includes pending (unsent) comments

FILE TREE KEYMAPS ~

Fugitive-style keybindings when focused on the file tree:
    Keymap          Action
    <CR> / o        Open file or toggle directory
    =               Toggle expand/collapse directory
    h               Collapse directory
    l               Expand directory or open file
    j / k / ( / )   Navigate files
    -               Toggle reviewed/staged
    s               Stage file (mark reviewed)
    u               Unstage file (mark unreviewed)
    <Space> / x     Toggle reviewed (alias)
    zM              Collapse all directories
    zR              Expand all directories
    <Tab>           Next hunk (across files)
    <S-Tab>         Previous hunk (across files)
    /               Filter files
    R               Refresh files from git
    q               Close review

COMMENT INPUT KEYMAPS ~

When typing a comment in the floating input window:
    Keymap          Action
    <C-s>           Save comment (insert or normal mode)
    <CR>            Save comment (normal mode only)
    <C-c>           Cancel comment
    @               Trigger @mention autocomplete (PR mode)
    <C-x><C-o>      Manual autocomplete trigger

COMMENT POPUP KEYMAPS ~

When viewing a comment with `K`:
For local comments:
    Keymap          Action
    e               Edit comment
    d               Delete comment
    q / <Esc>       Close popup
For GitHub comments:
    Keymap          Action
    r               Reply to comment
    R               Resolve/unresolve thread
    +               Add emoji reaction (picker)
    1-7             Quick reactions (üëçüëéüòÑüéâ‚ù§Ô∏èüöÄüëÄ)
    q / <Esc>       Close popup

DIFF VIEW KEYMAPS ~

When focused on the diff view:
    Keymap          Action
    <Tab>           Next hunk (across files)
    <S-Tab>         Previous hunk (across files)
    q               Close review
==============================================================================
WORKFLOW EXAMPLES                                   *review-workflow-examples*

LOCAL AI-GENERATED DIFF REVIEW ~

1. AI generates code changes
2. Run `:Review` to see diff
3. Add comments with `<leader>cc` (note), `<leader>ci` (issue), `<leader>cs` (suggestion)
4. Send to AI with `<leader>rs` (opens editable prompt - add instructions at top, edit as needed, `Ctrl-s` to send)
5. AI fixes issues (progress shown in floating indicator)
6. Hide diff with `<leader>rD` to make direct edits, toggle back to see changes
7. Repeat until satisfied

GITHUB PR REVIEW ~

1. Run `:Review pr` or `:Review pr 123`
2. Plugin fetches PR details, diff, and comments
3. See existing comments inline in diff
4. Add new comments (pending locally)
5. Reply to existing threads with `r`
6. Submit review with `<leader>rg`

HYBRID MODE (AUTO-DETECTED) ~

When you're on a branch with an open PR, `:Review` automatically opens in hybrid mode:
1. Shows all changes (pushed, local commits, uncommitted)
2. Each file shows provenance: where changes come from
3. Uses merge-base for diffing (only shows your PR's changes, not unrelated commits on main)
4. Comments on pushed files sync with GitHub
5. Comments on local/uncommitted files stay local
Provenance indicators in file tree:
    Symbol          Meaning
    ‚Üë             Pushed to remote (visible on GitHub)
    ‚óã             Local commits (not yet pushed)
    ~               Uncommitted changes
    ‚Üë‚óã          Both pushed and local changes

PR PICKER ~

The PR picker (`:Review pr`) shows your review status for each PR:
    Symbol          Meaning
    ‚óã             Not yet reviewed
    ‚úì             You approved
    ‚úó             You requested changes
    ‚óê             You commented
After approving or requesting changes, you'll be prompted to open the next unreviewed PR.

COMMENTABLE LINES ~

In PR mode, only lines within the diff can receive comments (GitHub limitation). Visual markers show commentable lines:
- `‚ñé` in the gutter indicates a commentable line
- Attempting to comment elsewhere shows a warning
==============================================================================
API                                                               *review-api*

>lua
    local review = require("review")
    -- Open reviews
    review.open()           -- Local diff against HEAD
    review.open("main")     -- Local diff against main
    review.open_pr(123)     -- Open PR #123
    review.pick_pr()        -- Open PR picker
    -- Session control
    review.close()          -- Close review
    review.toggle_panel()   -- Toggle PR panel
    review.refresh()        -- Refresh current review
    review.status()         -- Show review status
    -- Comments
    review.add_comment("note")        -- Add note
    review.add_comment("issue")       -- Add issue
    review.add_comment("suggestion")  -- Add suggestion
    review.add_comment("praise")      -- Add praise
    -- AI integration
    review.send_to_ai()           -- Open editable prompt and send to AI
    review.send_to_clipboard()    -- Copy prompt to clipboard
    -- State inspection
    review.is_active()    -- Check if session active
    review.get_state()    -- Get current state
    review.get_config()   -- Get configuration
    review.is_setup()     -- Check if plugin is set up
<
==============================================================================
vim:tw=78:ts=8:ft=help:norl: